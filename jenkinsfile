pipeline{

	agent any

  stages {
    stage('Build Image') {
      steps {
        sh 'docker build -t bitcoin-tracker .'
      }
    }

    stage('Push Image') {
      steps {

        withCredentials([string(credentialsId: 'DockerSecret', variable: 'TOKEN')]) {
            sh 'docker login -u waheeb96 -p ${TOKEN}'
            sh 'docker tag bitcoin-price waheeb96/bitcoin-tracker:latest'
            sh 'docker push waheeb96/bitcoin-tracker:latest'
        }
      }
    }
  }


	post {
		always {
			sh 'sudo docker logout'
		}
	}

}
